"use strict";!function(){function e(){}function t(t){var i=[],n=t;$(n).find("entry").each(function(){var t=new e;t.title=$(this).find("title").text(),t.longitude=$(this).find("longitude").text(),t.latitude=$(this).find("latitude").text(),t.code=$(this).find("code").text(),t.link=$(this).find("link").text(),t.description=$(this).find("description").text(),t.icon=$(this).find("icon").text(),i.push(t)}),i.length&&(l.campusLocations=i)}function i(){$.ajax({type:"GET",url:"xml/locations.xml",dataType:"xml",success:t})}function n(){}function o(e){var t,i=[],o=e;if($(o).find("entry").each(function(){var e=new n;e.title=$(this).find("title").text(),e.longitude=$(this).find("longitude").text(),e.latitude=$(this).find("latitude").text(),e.address=$(this).find("address").text(),e.hours=$(this).find("hours").text(),e.contact=$(this).find("contact").text(),e.code=$(this).find("code").text(),e.link=$(this).find("link").text(),e.description=$(this).find("description").text(),e.icon=$(this).find("icon").text(),i.push(e)}),i.length&&(l.ThePubs=i),l.ThePubs.length){for(t=0;t<l.ThePubs.length;t+=1)$("#ThePubsList").append('<li data-theme="c"><a href="#ThePubsDetailsPage"><h3>'+l.ThePubs[t].title+"</h3><p></p></a></li>");$("#ThePubsList").listview("refresh")}}function s(){$.ajax({type:"GET",url:"xml/12pubs.xml",dataType:"xml",success:o})}function a(e,t,i){e.hasClass("full-map")&&e.css("height",$(window).height()/1.2),e.hasClass("half-map")&&e.css("height",$(window).height()/2);var n=e[0],o={zoom:i,center:t,mapTypeId:google.maps.MapTypeId.ROADMAP},s=new google.maps.Map(n,o);return s}function d(){void 0!==navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(e){l.userLocation=e.coords.latitude+","+e.coords.longitude})}function h(e,t){if(l.userLocation.length&&t.length){var i,n=new google.maps.DirectionsService,o={origin:l.userLocation,destination:e,travelMode:google.maps.DirectionsTravelMode.WALKING};n.route(o,function(e,n){n===google.maps.DirectionsStatus.OK&&(i="Distance: "+e.routes[0].legs[0].distance.value+"m",t.html(i))})}else t.html("")}var l=function(){var e,t,i,n=0,o=0,s=0,a=[],d=[],h=[],l=[],u="";return{lat:n,lon:o,newLat:s,newLon:s,requestedIndex:e,requestedCode:t,requestedFacilityType:i,campusLocations:a,facilities:d,ThePubs:h,mapMarkers:l,userLocation:u}}();$(document).bind("mobileinit",function(){$.mobile.defaultPageTransition="none",window.top.scrollTo(0,1)}),$("#SplashPage").live("pageshow",function(e){window.setTimeout(function(){$.mobile.changePage($("#Homepage"),{transition:"none",reverse:!1,changeHash:!1})},3e3)}),$("#Homepage").live("pageinit",function(e){d(),i()}),$("#PubMap").live("pageshow",function(){function e(e,t,i,n){google.maps.event.addListener(e,"click",function(){m.setContent("<h4>"+l.campusLocations[i].title+'</h4><p></p><a href="'+l.campusLocations[i].link+'">More information</a>'),m.open(t,this)})}function t(e,t){var i=new google.maps.Polyline({path:e,geodesic:!0,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2});i.setMap(t)}i(),l.newLat=53.344134,l.newLon=-6.269902,d();var n,o,s,h,u,r,c=new google.maps.LatLng(l.newLat,l.newLon),p=a($(this).find(".mapCanvas"),c,17),g=new google.maps.LatLngBounds,m=new google.maps.InfoWindow;window.setTimeout(function(){if(l.campusLocations.length){l.mapMarkers.length=0;var n=[];for(u=0;u<l.campusLocations.length;u+=1){o=new google.maps.LatLng(l.campusLocations[u].latitude,l.campusLocations[u].longitude),h=new google.maps.Marker({position:o,map:p,title:l.campusLocations[u].title}),l.mapMarkers.push(h),n.push(o),g.extend(o),p.fitBounds(g);var s=l.campusLocations[u].title.split(". ")[1].split(" -")[0];e(h,p,u,s)}t(n,p)}else i()},1e3),google.maps.event.addListener(p,"zoom_changed",function(){var e=google.maps.event.addListener(p,"bounds_changed",function(t){this.getZoom()>18&&this.initialZoom===!0&&(this.setZoom(18),this.initialZoom=!1),google.maps.event.removeListener(e)})}),$("#txtMapSearch").on("change keyup",function(){if(r=$("#txtMapSearch").val().toLowerCase(),n=new google.maps.LatLngBounds,r.length){for(u=0;u<l.campusLocations.length;u+=1)-1===l.campusLocations[u].title.toLowerCase().indexOf(r)&&-1===l.campusLocations[u].code.toLowerCase().indexOf(r)?l.mapMarkers[u].setVisible(!1):(l.mapMarkers[u].setVisible(!0),p.initialZoom=!0,n.extend(l.mapMarkers[u].position));n.isEmpty()||p.fitBounds(n)}else for(u=0;u<l.campusLocations.length;u+=1)l.mapMarkers[u].setVisible(!0),p.fitBounds(g)}),$(".locate-me-btn").on("click, tap",function(){if(void 0!==navigator.geolocation){var e=new google.maps.MarkerImage("img/common/yourLoc.png",new google.maps.Size(44,44),new google.maps.Point(0,0),new google.maps.Point(22,22));navigator.geolocation.getCurrentPosition(function(t){s=new google.maps.LatLng(t.coords.latitude,t.coords.longitude),h=new google.maps.Marker({icon:e,position:s,map:p,animation:google.maps.Animation.DROP,title:"You are here"}),p.panTo(s)})}else alert("Geolocation services are not supported by your browser.")})}),$("#ThePubs").live("pageinit",function(e){s(),$("#ThePubsList").on("click","a",function(){l.requestedIndex=$(this).closest("li").index()})}),$("#ThePubsDetailsPage").live("pageshow",function(e){if(d(),void 0===l.ThePubs[l.requestedIndex])$.mobile.changePage($("#ThePubs"),{reverse:!1,changeHash:!1});else{var t=l.ThePubs[l.requestedIndex].latitude,i=l.ThePubs[l.requestedIndex].longitude,n=new google.maps.LatLng(t,i),o=a($(this).find(".mapCanvas"),n,17);new google.maps.Marker({position:n,map:o,title:" "});$(this).find("h1").html(l.ThePubs[l.requestedIndex].title),$(this).find("#stuServicesTitle").html(l.ThePubs[l.requestedIndex].title+'<span class="sub-head"></span>'),h(t+","+i,$(this).find(".sub-head")),l.ThePubs[l.requestedIndex].hours.length?($(this).find(".open-hours").html(l.ThePubs[l.requestedIndex].hours),$(this).find(".open-hours").show().prev("h3").show()):($(this).find(".open-hours").html(""),$(this).find(".open-hours").hide().prev("h3").hide()),l.ThePubs[l.requestedIndex].contact.length?($(this).find(".phone-list").html(l.ThePubs[l.requestedIndex].contact),$(this).find(".phone-list").show().prev("h3").show()):($(this).find(".phone-list").html(""),$(this).find(".phone-list").hide().prev("h3").hide()),l.ThePubs[l.requestedIndex].address.length?$(this).find(".dept-address").html(l.ThePubs[l.requestedIndex].address):$(this).find(".dept-address").html(""),l.ThePubs[l.requestedIndex].description.length?($(this).find(".pub-description").html(l.ThePubs[l.requestedIndex].description),$(this).find(".pub-description").show().prev("h3").show()):($(this).find(".pub-description").html(""),$(this).find(".pub-description").hide().prev("h3").hide())}}),$("#ThePubsDetailsPageFullMap").live("pageshow",function(e){if(void 0===l.ThePubs[l.requestedIndex])$.mobile.changePage($("#ThePubs"),{reverse:!1,changeHash:!1});else{var t=new google.maps.LatLng(l.ThePubs[l.requestedIndex].latitude,l.ThePubs[l.requestedIndex].longitude),i=a($(this).find(".mapCanvas"),t,17);new google.maps.Marker({position:t,map:i,title:"UCC"})}})}();